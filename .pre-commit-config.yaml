default_install_hook_types: [pre-commit, pre-push]
default_stages: [pre-commit]

repos:
  # Ruff - Fast Python linter and formatter (replaces Black, isort, flake8)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.13.0
    hooks:
      # Run the linter with auto-fix
      - id: ruff-check
        args: [--fix,--config=pyproject.toml]
      # Run the formatter with auto-formatting
      - id: ruff-format
        args: [--line-length=100]

  # Pyupgrade - Automatically upgrade Python syntax
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.20.0
    hooks:
      - id: pyupgrade
        args: [--py312-plus]
        exclude: ^(tests/|examples/)

  # General pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        stages: [pre-commit]
      - id: end-of-file-fixer
        stages: [pre-commit]
      - id: check-yaml
        stages: [pre-commit]
      - id: check-json
        stages: [pre-commit]
      - id: check-toml
        stages: [pre-commit]
      - id: pretty-format-json
        args: ["--autofix", "--indent", "4"]
        stages: [pre-commit]
      - id: check-added-large-files
        stages: [pre-commit]
      - id: debug-statements
        stages: [pre-commit]
      - id: check-ast
        stages: [pre-commit]
      - id: check-builtin-literals
        stages: [pre-commit]
      - id: check-merge-conflict
        stages: [pre-commit]

  - repo: https://github.com/abravalheri/validate-pyproject
    rev: v0.24.1
    hooks:
      - id: validate-pyproject

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.18.1
    hooks:
      - id: mypy
        additional_dependencies: [pydantic>=2.0, types-PyYAML]
        exclude: ^(tests/|examples/)

  - repo: local
    hooks:
      - id: pyright
        name: pyright
        entry: uv run pyright
        language: system
        types: [python]
        exclude: ^(tests/|examples/)
        pass_filenames: false


  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.6
    hooks:
      - id: bandit
        args: [-r, hexai]
        exclude: ^tests/

  # Security - Dependency vulnerabilities
  - repo: https://github.com/Lucas-C/pre-commit-hooks-safety
    rev: v1.4.2
    hooks:
      - id: python-safety-dependencies-check
        files: requirements.*\.txt$
        stages: [pre-commit]

  # Secret detection
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.28.0
    hooks:
      - id: gitleaks
        stages: [pre-commit]

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        args: [-d, relaxed]
        types: [yaml]
        stages: [pre-commit]

  - repo: local
    hooks:
      - id: check-test-structure
        name: Check test structure consistency
        entry: uv run scripts/check_test_structure.py
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: check-examples
        name: Check examples functionality
        entry: uv run scripts/check_examples.py
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: pytest
        name: Run pytest
        entry: uv run pytest tests/hexai/ -x --tb=short
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false


      - id: deptry
        name: deptry
        entry: uv run deptry .
        language: system
        always_run: true
        pass_filenames: false

      - id: vulture
        name: vulture - dead code detection
        entry: uv run vulture hexai/ --min-confidence 90
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: radon-complexity
        name: radon - code complexity analysis
        entry: uv run radon cc hexai/ --min B --show-complexity
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: safety-check
        name: safety - dependency vulnerability scan
        entry: uv run safety check --json
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true

      - id: branch-name-check
        name: Branch Name Check
        entry: |
            bash -c '
            # Retrieve the branch name from Git
            BRANCH_NAME=$(git symbolic-ref --short HEAD)

            # Define your naming convention regex pattern
            PATTERN="^(ci|dependabot\/pip|docs|experiment|feat|fix|refactor|test)\/[A-Za-z0-9._-]+$"

            # Check if the branch name matches the pattern
            if [[ $BRANCH_NAME =~ $PATTERN ]]; then
                echo "Branch name \"$BRANCH_NAME\" is valid."
                exit 0
            else
                echo "Branch name \"$BRANCH_NAME\" is invalid. It must match the pattern \"$PATTERN\"."
                exit 1
            fi
            '
        language: system
        pass_filenames: false
        always_run: true
