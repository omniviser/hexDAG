default_install_hook_types: [pre-commit, pre-push]
default_stages: [pre-commit]

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        stages: [pre-commit]
      - id: end-of-file-fixer
        stages: [pre-commit]
      - id: check-yaml
        stages: [pre-commit]
      - id: check-json
        stages: [pre-commit]
      - id: check-toml
        stages: [pre-commit]
      - id: pretty-format-json
        args: ["--autofix", "--indent", "4"]
        stages: [pre-commit]
      - id: check-added-large-files
        stages: [pre-commit]
      - id: debug-statements
        stages: [pre-commit]
      - id: check-ast
        stages: [pre-commit]
      - id: check-builtin-literals
        stages: [pre-commit]
      - id: check-merge-conflict
        stages: [pre-commit]

  - repo: https://github.com/abravalheri/validate-pyproject
    rev: v0.24.1
    hooks:
      - id: validate-pyproject

  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black
        language_version: python3.12
        args: [--line-length=100]

  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        args: [--profile=black, --line-length=100]

  - repo: https://github.com/pycqa/flake8
    rev: 7.1.1
    hooks:
       - id: flake8
         exclude: ^examples/
         additional_dependencies:
           - flake8-docstrings
           - flake8-import-order
           - flake8-bugbear
           - flake8-comprehensions
           - flake8-print
           - pep8-naming

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.17.1
    hooks:
      - id: mypy
        additional_dependencies: [pydantic>=2.0, types-PyYAML]
        exclude: ^(tests/|examples/)

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.9
    hooks:
      # Run the linter.
      - id: ruff-check
        args: [ --fix, --line-length=100]
      # Run the formatter.
      - id: ruff-format
        args: [--line-length=100]

  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.6
    hooks:
      - id: bandit
        args: [-r, hexai]
        exclude: ^tests/

  - repo: local
    hooks:
      - id: check-test-structure
        name: Check test structure consistency
        entry: uv run scripts/check_test_structure.py
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: check-examples
        name: Check examples functionality
        entry: uv run scripts/check_examples.py
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false

      - id: pytest
        name: Run pytest
        entry: uv run pytest tests/hexai/ -x --tb=short
        language: system
        types: [python]
        stages: [pre-commit]
        pass_filenames: false


      - id: deptry
        name: deptry
        entry: uv run deptry .
        language: system
        always_run: true
        pass_filenames: false

      - id: branch-name-check
        name: Branch Name Check
        entry: |
            bash -c '
            # Retrieve the branch name from Git
            BRANCH_NAME=$(git symbolic-ref --short HEAD)

            # Define your naming convention regex pattern
            PATTERN="^(ci|dependabot\/pip|docs|experiment|feat|fix|refactor|test)\/[A-Za-z0-9._-]+$"

            # Check if the branch name matches the pattern
            if [[ $BRANCH_NAME =~ $PATTERN ]]; then
                echo "Branch name \"$BRANCH_NAME\" is valid."
                exit 0
            else
                echo "Branch name \"$BRANCH_NAME\" is invalid. It must match the pattern \"$PATTERN\"."
                exit 1
            fi
            '
        language: system
        pass_filenames: false
        always_run: true
