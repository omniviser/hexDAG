# Configuration for scripts/check_core_imports.py
#
# This enforces the architectural principle that hexdag/core contains pure
# abstractions (ports, domain models) and should NOT import from concrete
# implementations in hexdag/adapters or hexdag/builtin.
#
# Allowed exceptions are documented below with rationale.

# Directory to check (relative to repo root)
check_directory: hexdag/core

# Forbidden import patterns (regex)
forbidden_patterns:
  - '^from\s+hexdag\.adapters'
  - '^from\s+hexdag\.builtin'
  - '^import\s+hexdag\.adapters'
  - '^import\s+hexdag\.builtin'

# Allowed exceptions: file_path -> [list of exact import statements]
# Each exception requires a comment explaining WHY it's needed.
allowed_exceptions:
  # Orchestrator needs default executor implementation
  # This is the ONLY place where core imports from adapters.
  # Rationale: User convenience - orchestrator works out-of-the-box without
  # requiring explicit executor injection in every use case.
  hexdag/core/orchestration/orchestrator.py:
    - "from hexdag.adapters.executors import LocalExecutor  # noqa: PLC0415"

  # PortsBuilder provides convenience factory methods for common adapters
  # These are lazy imports inside helper methods, not module-level dependencies.
  # Rationale: Developer experience - quick setup without manual instantiation.
  hexdag/core/ports_builder.py:
    - "from hexdag.builtin.adapters.local import LocalObserverManager"
    - "from hexdag.builtin.adapters.local import LocalPolicyManager"
    - "from hexdag.builtin.adapters.mock import MockLLM"
    - "from hexdag.builtin.adapters.openai import OpenAIAdapter"
    - "from hexdag.builtin.adapters.anthropic import AnthropicAdapter"

  # YamlBuilder needs FieldMappingRegistry for YAML pipeline compilation
  # This is a compile-time dependency for the YAML DSL.
  # Rationale: YAML builder is inherently tied to built-in node implementations.
  hexdag/core/pipeline_builder/yaml_builder.py:
    - "from hexdag.builtin.nodes.mapped_input import FieldMappingRegistry"

  # Models.py has doctest examples that import adapters for demonstration
  # These are documentation/test imports, not runtime dependencies.
  # Rationale: Doctests need concrete examples to be runnable.
  hexdag/core/orchestration/models.py:
    - "from hexdag.builtin.adapters.mock import MockLLM"
    - "from hexdag.builtin.adapters.openai import OpenAIAdapter"
    - "from hexdag.builtin.adapters.anthropic import AnthropicAdapter"
