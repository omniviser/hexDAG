{
    "$defs": {
        "AgentNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for agent_node type",
            "properties": {
                "kind": {
                    "const": "agent_node",
                    "description": "Node type: agent_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "config": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "continuation_prompts": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "main_prompt": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        }
                    },
                    "required": [
                        "main_prompt"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "ConditionalNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for conditional_node type",
            "properties": {
                "kind": {
                    "const": "conditional_node",
                    "description": "Node type: conditional_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "description": "Multi-branch conditional router for workflow control flow",
                    "properties": {
                        "branches": {
                            "description": "List of condition branches evaluated in order",
                            "items": {
                                "properties": {
                                    "action": {
                                        "description": "Action name to return if condition matches",
                                        "type": "string"
                                    },
                                    "condition": {
                                        "description": "Expression like 'node.field == value' or callable",
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "condition",
                                    "action"
                                ],
                                "type": "object"
                            },
                            "type": "array"
                        },
                        "else_action": {
                            "description": "Default action if no branch conditions match",
                            "type": "string"
                        },
                        "tie_break": {
                            "default": "first_true",
                            "description": "Strategy for handling multiple matching branches",
                            "enum": [
                                "first_true"
                            ],
                            "type": "string"
                        }
                    },
                    "required": [
                        "branches"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "EventHandler": {
            "description": "Event handler configuration",
            "properties": {
                "params": {
                    "description": "Handler-specific parameters",
                    "type": "object"
                },
                "severity": {
                    "description": "Alert severity level",
                    "enum": [
                        "low",
                        "medium",
                        "high",
                        "critical"
                    ],
                    "type": "string"
                },
                "tags": {
                    "description": "Tags for categorization",
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "target": {
                    "description": "Target system (e.g., 'pagerduty', 'datadog', 'slack')",
                    "type": "string"
                },
                "type": {
                    "description": "Handler type (e.g., 'alert', 'metrics', 'log')",
                    "enum": [
                        "alert",
                        "metrics",
                        "log",
                        "webhook",
                        "callback"
                    ],
                    "type": "string"
                }
            },
            "required": [
                "type"
            ],
            "type": "object"
        },
        "FunctionNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for function_node type",
            "properties": {
                "kind": {
                    "const": "function_node",
                    "description": "Node type: function_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "fn": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        },
                        "input_mapping": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "input_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        }
                    },
                    "required": [
                        "fn"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "LlmNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for llm_node type",
            "properties": {
                "kind": {
                    "const": "llm_node",
                    "description": "Node type: llm_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "type": "string"
                        },
                        "output_schema": {
                            "default": null,
                            "type": "string"
                        },
                        "parse_json": {
                            "default": false,
                            "type": "string"
                        },
                        "parse_strategy": {
                            "default": "json",
                            "type": "string"
                        },
                        "prompt_template": {
                            "default": null,
                            "type": "string"
                        },
                        "system_prompt": {
                            "default": null,
                            "type": "string"
                        },
                        "template": {
                            "default": null,
                            "type": "string"
                        }
                    },
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "LoopNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for loop_node type",
            "properties": {
                "kind": {
                    "const": "loop_node",
                    "description": "Node type: loop_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "description": "Loop control node for iterative processing",
                    "properties": {
                        "body": {
                            "description": "Module path to body function: (data, state) -> Any",
                            "type": "string"
                        },
                        "collect_mode": {
                            "default": "last",
                            "description": "How to collect results: last value, all values, or reduced",
                            "enum": [
                                "last",
                                "list",
                                "reduce"
                            ],
                            "type": "string"
                        },
                        "initial_state": {
                            "default": {},
                            "description": "Initial state dict passed to first iteration",
                            "type": "object"
                        },
                        "iteration_key": {
                            "default": "loop_iteration",
                            "description": "Key name for current iteration number in state",
                            "type": "string"
                        },
                        "max_iterations": {
                            "default": 100,
                            "description": "Maximum number of iterations before stopping",
                            "type": "integer"
                        },
                        "while_condition": {
                            "description": "Module path to condition function: (data, state) -> bool",
                            "type": "string"
                        }
                    },
                    "required": [
                        "while_condition",
                        "body"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "Node": {
            "description": "Base node structure",
            "properties": {
                "kind": {
                    "type": "string"
                },
                "metadata": {
                    "type": "object"
                },
                "spec": {
                    "type": "object"
                }
            },
            "type": "object"
        },
        "Tool_CallNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for tool_call_node type",
            "properties": {
                "kind": {
                    "const": "tool_call_node",
                    "description": "Node type: tool_call_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "arguments": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "tool_call_id": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "tool_name": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "tool_name"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        }
    },
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "(auto-generated from builtin nodes)",
    "properties": {
        "apiVersion": {
            "default": "v1",
            "description": "API version",
            "type": "string"
        },
        "kind": {
            "const": "Pipeline",
            "description": "Resource kind (must be 'Pipeline')",
            "type": "string"
        },
        "metadata": {
            "properties": {
                "author": {
                    "description": "Pipeline author",
                    "type": "string"
                },
                "description": {
                    "description": "Pipeline description",
                    "type": "string"
                },
                "name": {
                    "description": "Unique pipeline identifier",
                    "type": "string"
                },
                "tags": {
                    "description": "Categorization tags",
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "version": {
                    "description": "Semantic version (e.g., 1.0.0)",
                    "type": "string"
                }
            },
            "required": [
                "name"
            ],
            "type": "object"
        },
        "spec": {
            "properties": {
                "common_field_mappings": {
                    "description": "Reusable field mapping definitions",
                    "type": "object"
                },
                "events": {
                    "description": "Event handlers for observability",
                    "properties": {
                        "on_node_completed": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_node_failed": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_node_started": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_workflow_complete": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        }
                    },
                    "type": "object"
                },
                "input_schema": {
                    "description": "JSON Schema for pipeline inputs",
                    "type": "object"
                },
                "nodes": {
                    "description": "List of pipeline nodes",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/$defs/FunctionNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/LlmNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/AgentNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/LoopNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/ConditionalNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/Tool_CallNodeSpec"
                            }
                        ]
                    },
                    "type": "array"
                },
                "output_schema": {
                    "description": "JSON Schema for pipeline outputs",
                    "type": "object"
                },
                "policies": {
                    "additionalProperties": {
                        "properties": {
                            "params": {
                                "description": "Policy parameters",
                                "type": "object"
                            },
                            "type": {
                                "description": "Policy type",
                                "type": "string"
                            }
                        },
                        "type": "object"
                    },
                    "description": "Execution policies (retry, timeout, error handling)",
                    "type": "object"
                },
                "ports": {
                    "additionalProperties": {
                        "properties": {
                            "adapter": {
                                "description": "Adapter type",
                                "type": "string"
                            },
                            "params": {
                                "description": "Adapter parameters",
                                "type": "object"
                            }
                        },
                        "type": "object"
                    },
                    "description": "Port adapters configuration (LLM, database, memory)",
                    "type": "object"
                },
                "type_ports": {
                    "additionalProperties": {
                        "type": "string"
                    },
                    "description": "Port type mappings",
                    "type": "object"
                }
            },
            "required": [
                "nodes"
            ],
            "type": "object"
        }
    },
    "required": [
        "kind",
        "metadata",
        "spec"
    ],
    "title": "hexDAG Pipeline",
    "type": "object"
}
