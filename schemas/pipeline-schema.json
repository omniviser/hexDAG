{
    "$defs": {
        "AgentNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for agent_node type",
            "properties": {
                "kind": {
                    "const": "agent_node",
                    "description": "Node type: agent_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "config": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "continuation_prompts": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "main_prompt": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        }
                    },
                    "required": [
                        "main_prompt"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "ConditionalNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for conditional_node type",
            "properties": {
                "kind": {
                    "const": "conditional_node",
                    "description": "Node type: conditional_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {},
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "EventHandler": {
            "description": "Event handler configuration",
            "properties": {
                "params": {
                    "description": "Handler-specific parameters",
                    "type": "object"
                },
                "severity": {
                    "description": "Alert severity level",
                    "enum": [
                        "low",
                        "medium",
                        "high",
                        "critical"
                    ],
                    "type": "string"
                },
                "tags": {
                    "description": "Tags for categorization",
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "target": {
                    "description": "Target system (e.g., 'pagerduty', 'datadog', 'slack')",
                    "type": "string"
                },
                "type": {
                    "description": "Handler type (e.g., 'alert', 'metrics', 'log')",
                    "enum": [
                        "alert",
                        "metrics",
                        "log",
                        "webhook",
                        "callback"
                    ],
                    "type": "string"
                }
            },
            "required": [
                "type"
            ],
            "type": "object"
        },
        "FunctionNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for function_node type",
            "properties": {
                "kind": {
                    "const": "function_node",
                    "description": "Node type: function_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "fn": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        },
                        "input_mapping": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "input_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        }
                    },
                    "required": [
                        "fn"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "LlmNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for llm_node type",
            "properties": {
                "kind": {
                    "const": "llm_node",
                    "description": "Node type: llm_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        },
                        "template": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        }
                    },
                    "required": [
                        "template"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "LoopNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for loop_node type",
            "properties": {
                "kind": {
                    "const": "loop_node",
                    "description": "Node type: loop_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {},
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "Node": {
            "description": "Base node structure",
            "properties": {
                "kind": {
                    "type": "string"
                },
                "metadata": {
                    "type": "object"
                },
                "spec": {
                    "type": "object"
                }
            },
            "type": "object"
        },
        "ParserNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for parser_node type",
            "properties": {
                "kind": {
                    "const": "parser_node",
                    "description": "Node type: parser_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "output_schema": {
                            "anyOf": [
                                {
                                    "type": "object"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        },
                        "strategy": {
                            "default": "json",
                            "type": "string"
                        },
                        "strict": {
                            "default": true,
                            "type": "boolean"
                        }
                    },
                    "required": [
                        "output_schema"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "PromptNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for prompt_node type",
            "properties": {
                "kind": {
                    "const": "prompt_node",
                    "description": "Node type: prompt_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "output_format": {
                            "default": "messages",
                            "type": "string"
                        },
                        "prompt_args": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "prompt_ref": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "system_prompt": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "template": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ],
                            "default": null
                        }
                    },
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "Raw_LlmNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for raw_llm_node type",
            "properties": {
                "kind": {
                    "const": "raw_llm_node",
                    "description": "Node type: raw_llm_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "tool_choice": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "object"
                                }
                            ],
                            "default": "auto"
                        },
                        "tools": {
                            "default": null,
                            "items": {
                                "type": "object"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        }
                    },
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        },
        "Tool_CallNodeSpec": {
            "allOf": [
                {
                    "$ref": "#/$defs/Node"
                }
            ],
            "description": "Specification for tool_call_node type",
            "properties": {
                "kind": {
                    "const": "tool_call_node",
                    "description": "Node type: tool_call_node"
                },
                "metadata": {
                    "properties": {
                        "annotations": {
                            "description": "Optional metadata annotations",
                            "type": "object"
                        },
                        "name": {
                            "description": "Unique node identifier within the pipeline",
                            "type": "string"
                        }
                    },
                    "required": [
                        "name"
                    ],
                    "type": "object"
                },
                "spec": {
                    "additionalProperties": false,
                    "properties": {
                        "arguments": {
                            "default": null,
                            "type": [
                                "object",
                                "null"
                            ]
                        },
                        "deps": {
                            "default": null,
                            "items": {
                                "type": "string"
                            },
                            "type": [
                                "array",
                                "null"
                            ]
                        },
                        "tool_call_id": {
                            "default": null,
                            "type": [
                                "string",
                                "null"
                            ]
                        },
                        "tool_name": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "tool_name"
                    ],
                    "type": "object"
                }
            },
            "required": [
                "kind",
                "metadata",
                "spec"
            ],
            "type": "object"
        }
    },
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "(auto-generated from builtin nodes)",
    "properties": {
        "apiVersion": {
            "default": "v1",
            "description": "API version",
            "type": "string"
        },
        "kind": {
            "const": "Pipeline",
            "description": "Resource kind (must be 'Pipeline')",
            "type": "string"
        },
        "metadata": {
            "properties": {
                "author": {
                    "description": "Pipeline author",
                    "type": "string"
                },
                "description": {
                    "description": "Pipeline description",
                    "type": "string"
                },
                "name": {
                    "description": "Unique pipeline identifier",
                    "type": "string"
                },
                "tags": {
                    "description": "Categorization tags",
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "version": {
                    "description": "Semantic version (e.g., 1.0.0)",
                    "type": "string"
                }
            },
            "required": [
                "name"
            ],
            "type": "object"
        },
        "spec": {
            "properties": {
                "common_field_mappings": {
                    "description": "Reusable field mapping definitions",
                    "type": "object"
                },
                "events": {
                    "description": "Event handlers for observability",
                    "properties": {
                        "on_node_completed": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_node_failed": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_node_started": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        },
                        "on_workflow_complete": {
                            "items": {
                                "$ref": "#/$defs/EventHandler"
                            },
                            "type": "array"
                        }
                    },
                    "type": "object"
                },
                "input_schema": {
                    "description": "JSON Schema for pipeline inputs",
                    "type": "object"
                },
                "nodes": {
                    "description": "List of pipeline nodes",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#/$defs/FunctionNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/LlmNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/Raw_LlmNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/PromptNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/ParserNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/AgentNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/LoopNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/ConditionalNodeSpec"
                            },
                            {
                                "$ref": "#/$defs/Tool_CallNodeSpec"
                            }
                        ]
                    },
                    "type": "array"
                },
                "output_schema": {
                    "description": "JSON Schema for pipeline outputs",
                    "type": "object"
                },
                "policies": {
                    "additionalProperties": {
                        "properties": {
                            "params": {
                                "description": "Policy parameters",
                                "type": "object"
                            },
                            "type": {
                                "description": "Policy type",
                                "type": "string"
                            }
                        },
                        "type": "object"
                    },
                    "description": "Execution policies (retry, timeout, error handling)",
                    "type": "object"
                },
                "ports": {
                    "additionalProperties": {
                        "properties": {
                            "adapter": {
                                "description": "Adapter type",
                                "type": "string"
                            },
                            "params": {
                                "description": "Adapter parameters",
                                "type": "object"
                            }
                        },
                        "type": "object"
                    },
                    "description": "Port adapters configuration (LLM, database, memory)",
                    "type": "object"
                },
                "type_ports": {
                    "additionalProperties": {
                        "type": "string"
                    },
                    "description": "Port type mappings",
                    "type": "object"
                }
            },
            "required": [
                "nodes"
            ],
            "type": "object"
        }
    },
    "required": [
        "kind",
        "metadata",
        "spec"
    ],
    "title": "hexDAG Pipeline",
    "type": "object"
}
